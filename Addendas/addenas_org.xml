<!-- ADDENDA FARMACIA GUADALAJARA -->

<?xml version="1.0"?>
<template name="Farmacia Guadalajara" t-name="add.addenda_farmaciaG01">
  <requestForPayment type="SimpleInvoiceType" contentVersion="1.3.1" documentStructureVersion="AMC006" documentStatus="ORIGINAL">
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()"/>
    <deliveryDate t-field="record.date_invoice" />
    <requestForPaymentIdentification>
      <entityType>INVOICE</entityType>
      <t t-set="serie" t-value="xml.get('Serie')" />
      <t t-set="folio" t-value="xml.get('Folio')" />
      <uniqueCreatorIdentification t-esc="serie+folio" />
    </requestForPaymentIdentification>
    <orderIdentification>
      <referenceIdentification type="ON" t-field="record.field_sales.number_order" />
    </orderIdentification>
    <buyer>
      <gln t-field="record.partner_id.gln" />
    </buyer>
    <seller>
      <t t-set="numprov" t-value="record.partner_id.number_provideer" />
      <alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY" t-esc="numprov" />
    </seller>
    <shipTo>
      <t t-set="identification" t-value="record.partner_id.type_suc"/>
      <t t-set="number" t-value="record.partner_id.number_sucursal" />
      <alternatePartyIdentification type="ASSIGNED_IDENTIFIER_FOR_A_BUYER" t-esc="identification+number" />
    </shipTo>
    <currency>
      <currencyISOCode t-field="record.currency_id.name" />
      <currencyFunction>BILLING_CURRENCY</currencyFunction>
      <rateOfChange>1</rateOfChange>
    </currency>
    <t t-set="cont" t-value="0" />
    <t t-foreach="record.field_sales.order_line" t-as="rec" >
      <t t-set="cont" t-value="cont + 1" />
      <lineItem>
        <type>SimpleInvoiceLineItemType</type>
        <number t-esc="cont" />
        <tradeItemIdentification>
          <gtin t-esc="rec.product_id.barcode" />
        </tradeItemIdentification>
        <tradeItemDescriptionInformation>
          <language>ES</language>
          <longText t-esc="rec.product_id.name" />
        </tradeItemDescriptionInformation>
        <invoicedQuantity>
          <unitOfMeasure t-esc="rec.product_uom.name" />
          <quantity t-esc="rec.product_uom_qty" />
        </invoicedQuantity>
        <grossPrice>
          <amount t-esc="rec.price_unit" />
        </grossPrice>
        <netPrice>
          <t t-set="pricenet" t-value="rec.price_unit" />
          <t t-foreach="rec.tax_id" t-as="tc" >
            <t t-foreach="tc.tag_ids" t-as="tg" >
              <t t-if="tg.name != 'IEPS'" >
                <t t-set="result" t-value="rec.price_unit" />
                <t t-set="resultoper" t-value="result * (tc.amount / 100)" />
                <t t-set="pricenet" t-value="pricenet + resultoper" />
              </t>
            </t>
          </t>
          <amount t-esc="pricenet"  />
        </netPrice>
          <t t-set="amount" t-value="0" />
          <t t-foreach="rec.tax_id" t-as="tac" >
            <t t-foreach="tac.tag_ids" t-as="tag" >
              <t t-if="record.partner_id.most_ieps == False">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
              <t t-else="">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
                <t t-else="">
                  <tradeItemTaxInformation>
                    <taxTypeDescription>IEPS</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxAmount t-esc="tac.amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
            </t>
          </t>
          <totalLineAmount>
            <netAmount>
              <amount t-esc="rec.price_unit * rec.product_uom_qty" />
            </netAmount>
          </totalLineAmount>
      </lineItem>
    </t>
    <TotalAllowanceCharge allowanceOrChargeType="ALLOWANCE">
      <Amount>0.00</Amount>
    </TotalAllowanceCharge>
    <baseAmount>
      <t t-set="valamount" t-value="0" />
      <t t-foreach="record.field_sales.order_line" t-as="rec">
        <t t-foreach="rec.tax_id" t-as="tac">
          <t t-foreach="tac.tag_ids" t-as="tag">
            <t t-if="record.partner_id.most_ieps == False">
              <t t-set="result" t-value="rec.price_unit" />
              <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
              <t t-set="valamount" t-value="valamount + resultoper" />
            </t>
            <t t-else="">
              <t t-set="valieps" t-value="0" />
              <t t-if="tag.name != 'IEPS'">
                <t t-set="result" t-value="rec.price_unit" />
                <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                <t t-set="valamount" t-value="valamount + resultoper" />
              </t>
              <t t-if="tag.name == 'IEPS'" >
                <t t-set="valieps" t-value="tac.amount" />
              </t>
              <t t-set="valamount" t-value="valamount + valieps" />
            </t> 
          </t>
        </t>
      </t>
      <Amount t-esc="valamount" />
    </baseAmount>
    <payableAmount>
      <t t-set="valpay" t-value="0" />
      <t t-foreach="record.field_sales.order_line" t-as="rec">
        <t t-set="valpay" t-value="valpay + rec.price_subtotal" />
      </t>
      <Amount t-esc="valpay" />
    </payableAmount>
  </requestForPayment>
</template>

<!-- ADDENDA 7 / 24 -->

<?xml version="1.0"?>
<template name="7/24" t-name="add.addenda_7/24_01">
  <Referencia724>
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />
    <t t-set="rfc" t-value="xml.Emisor.get('Rfc')" />
    <t t-set="serie" t-value="xml.get('Serie')" />
    <t t-set="folio" t-value="xml.get('Folio')" />
    <t t-set="suc" t-value="record.partner_id.type_suc" />
    <t t-set="num" t-value="record.partner_id.number_sucursal" />
    <referencia t-esc="rfc+','+suc+num+','+serie+folio" />
    <fechaDeEntrega t-field="record.field_sales.date_of_deli" t-options='{"format": "yyyy/MM/dd"}' />
    <numeroOrden t-field="record.field_sales.number_order" />
  </Referencia724>
</template>

<!-- ADDENDA SUPER PRECIO -->

<?xml version="1.0"?>
<template name="SuperPrecio" t-name="add.addenda_superprecio01">
    <Documento>
      <tipoComprobante>FE</tipoComprobante>
      <plazoPago t-field="record.field_sales.payment_term_id" />
      <t t-if="record.field_sales.note == ''">
        <observaciones>NINGUNA</observaciones>
      </t>
      <t t-else="">
        <observaciones t-field="record.field_sales.note" />
      </t>
      <Detalle>
        <folio t-field="record.reference" />
        <t t-foreach="record.field_sales.order_line" t-as="rec">
          <Producto>
            <codigoBarras t-esc="rec.product_id.barcode" />
            <cajasEntregadas t-esc="rec.product_uom_qty" />
            <precioUnitarioCaja t-esc="rec.price_unit" />
            <t t-set="piez_ent" t-value="rec.product_id.uom_id.factor * rec.product_uom_qty" />
            <piezasEntregadas t-esc="piez_ent" />
            <t t-set="oper1" t-value="rec.price_unit * rec.product_uom_qty" />
            <t t-set="oper2" t-value="oper1 / piez_ent" />
            <precioUnitarioPieza t-esc="oper2" />
            <Impuestos>
              <t t-set="cont" t-value="0" />
              <t t-foreach="rec.tax_id"  t-as="tc">
                <t t-foreach="tc.tag_ids" t-as="tg">
                  <t t-if="record.partner_id.most_ieps == False">
                    <t t-if="tg.name != 'IEPS'">
                      <t t-set="resultimp" t-value="rec.price_unit" />
                      <t t-set="resoperimp" t-value="resultimp * (tc.amount / 100)"  />
                      <t t-set="cont" t-value="cont + resoperimp"  />
                    </t>
                  </t>
                  <t t-else="">
                    <t t-set="resultimp" t-value="rec.price_unit" />
                    <t t-set="resoperimp" t-value="resultimp * (tc.amount / 100)"  />
                    <t t-set="cont" t-value="cont + resoperimp"  />
                  </t>
                </t>
              </t>
              <totalImpuestosTrasladados t-esc="cont" />
              <Traslados>
                <t t-foreach="rec.tax_id" t-as="tac">
                  <t t-foreach="tac.tag_ids" t-as="tag">
                    <t t-set="resultimpuest" t-value="rec.price_unit" />
                    <t t-if="record.partner_id.most_ieps == False" >
                      <t t-if="tag.name != 'IEPS'" >
                        <Traslado>
                          <impuesto t-esc="tag.name" />
                          <tasa t-esc="tac.amount" />
                          <importe t-esc="resultimpuest * (tac.amount / 100)" />
                        </Traslado>
                      </t>
                    </t>
                    <t t-else="">
                      <Traslado>
                        <impuesto t-esc="tag.name" />
                        <importe t-esc="tac.amount" />
                      </Traslado>
                    </t>
                  </t>
                </t>
              </Traslados>
            </Impuestos>
          </Producto>
        </t>
        <fechaDeEntrega t-field="record.field_sales.date_of_deli" />
        <numeroOrden t-field="record.field_sales.number_order" />
        <fechaPedidoCliente t-field="record.date_invoice" />
        <camppAddic t-field="record.field_sales.field_add_capture" />
      </Detalle>
    </Documento>
</template>

<!-- ADDENDA TIENDAS3B -->

<?xml version="1.0"?>
<template name="TiendasTresB" t-name="add.addenda_tiendasTresB">
  <requestForPayment type="SimpleInvoiceType" contentVersion="1.3.1" documentStructureVersion="AMC7.1" documentStatus="ORIGINAL">
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />
    <requestForPaymentIdentification>
      <entityType>INVOICE</entityType>
      <t t-set="folio" t-value="xml.get('Folio')" />
      <uniqueCreatorIdentification t-esc="folio" />
    </requestForPaymentIdentification>
    <specialInstruction code="zzz">
      <text t-field="record.amount_to_text" />
    </specialInstruction>
    <seller>
      <alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY">
      </alternatePartyIdentification>
    </seller>
    <shipTo>
      <gln t-field="record.partner_id.number_sucursal"/>
      <nameAndAddress>
        <name t-field="record.partner_id.name" />
        <streetAddressOne t-field="record.partner_id.street" />
        <city t-field="record.partner_id.city"/>
        <postalCode t-field="record.partner_id.zip"/>
      </nameAndAddress>
    </shipTo>
    <currency>
      <currencyISOCode t-field="record.currency_id.name" />
    </currency>
    <t t-set="cont" t-value="0" />
    <t t-foreach="record.field_sales.order_line" t-as="rec" >
      <t t-set="cont" t-value="cont + 1" />
      <lineItem type="SimpleInvoiceLineItemType">
        <number t-esc="cont" />
        <tradeItemIdentification>
          <gtin t-esc="rec.product_id.barcode" />
        </tradeItemIdentification>
        <tradeItemDescriptionInformation>
          <language>ES</language>
          <longText t-esc="rec.product_id.name" />
        </tradeItemDescriptionInformation>
        <invoicedQuantity>
          <unitOfMeasure t-esc="rec.product_uom.name" />
          <quantity t-esc="rec.product_uom_qty" />
        </invoicedQuantity>
        <grossPrice>
          <amount t-esc="rec.price_unit" />
        </grossPrice>
        <netPrice>
          <t t-set="pricenet" t-value="rec.price_unit" />
          <t t-foreach="rec.tax_id" t-as="tc" >
            <t t-foreach="tc.tag_ids" t-as="tg" >
              <t t-if="tg.name != 'IEPS'" >
                <t t-set="result" t-value="rec.price_unit" />
                <t t-set="resultoper" t-value="result * (tc.amount / 100)" />
                <t t-set="pricenet" t-value="pricenet + resultoper" />
              </t>
            </t>
          </t>
          <amount t-esc="pricenet"  />
        </netPrice>
          <t t-set="amount" t-value="0" />
          <t t-foreach="rec.tax_id" t-as="tac" >
            <t t-foreach="tac.tag_ids" t-as="tag" >
              <t t-if="record.partner_id.most_ieps == False">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
              <t t-else="">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
                <t t-else="">
                  <tradeItemTaxInformation>
                    <taxTypeDescription>IEPS</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxAmount t-esc="tac.amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
            </t>
          </t>
          <totalLineAmount>
            <netAmount>
              <amount t-esc="rec.price_unit * rec.product_uom_qty" />
            </netAmount>
          </totalLineAmount>
      </lineItem>
    </t>
    <totalAmount>
      <t t-set="valamount" t-value="0" />
      <t t-foreach="record.field_sales.order_line" t-as="rec" >
        <t t-set="valamount" t-value="valamount + rec.price_subtotal"/>
      </t>
      <Amount t-esc="valamount" />
    </totalAmount>
    <baseAmount>
      <Amount t-esc="valamount" />
    </baseAmount>
    <fechaEntregaRequerida t-field="record.field_sales.date_of_deli" />
    <numeroOrden t-field="record.field_sales.number_order" />
    <numeroTienda t-field="record.partner_id.number_store" />
  </requestForPayment>
</template>

<!-- SAN FRANCISCO DE ASIS -->

<?xml version="1.0"?>
<template name="San Francisco de Asis" t-name="add.sanFrancisco"> 
  <requestForPayment type="SimpleInvoiceType" contentVersion="1.3.1" documentStructureVersion="AMC7.1" documentStatus="ORIGINAL">
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />
    <deliveryDate t-field="record.date_invoice" />
    <requestForPaymentIdentification>
      <entityType>INVOICE</entityType>
      <t t-set="serie" t-value="xml.get('Serie')" />
      <t t-set="folio" t-value="xml.get('Folio')" />
      <uniqueCreatorIdentification t-esc="serie+folio" />
    </requestForPaymentIdentification>
    <specialInstruction code="ZZZ">
      <!-- <text t-field="record.amount_to_text" /> -->
    </specialInstruction>
    <orderIdentification>
      <referenceIdentification type="ON" t-field="record.field_sales.number_order" />
      <ReferenceDate></ReferenceDate>
    </orderIdentification>
    <AdditionalInformation>
      <referenceIdentification type="IV"></referenceIdentification>
    </AdditionalInformation>
    <DeliveryNote>
      <referenceIdentification>0</referenceIdentification>
      <ReferenceDate></ReferenceDate>
    </DeliveryNote>
    <buyer>
      <gln t-field="record.partner_id.gln" />
      <contactInformation>
        <personDepartamentName>
          <text t-field="record.partner_id.user_id.name" />
        </personDepartamentName>
      </contactInformation>
    </buyer>
    <seller>
      <gln></gln>
      <alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY">
        <numberProveedor t-field="record.partner_id.number_provideer" />
      </alternatePartyIdentification>
    </seller>
    <shipTo>
      <gln t-field="record.partner_id.number_sucursal" />
      <nameAddress>
        <name t-field="record.partner_id.name" />
        <streetAddressOne t-field="record.partner_id.street" />
        <city t-field="record.partner_id.city"/>
        <postalCode t-field="record.partner_id.zip"/>
      </nameAddress>
    </shipTo>
    <currency>
      <currencyISOCode t-field="record.currency_id.name" />
      <currencyFunction>BILLING_CURRENCY</currencyFunction>
      <rateOfChange>1</rateOfChange>
    </currency>
    <paymentTerms paymentTermsEvent="DATE_OF_INVOICE" PaymentTermsRelationTime="REFERENCE_AFTER">
      <netPayment netPaymentTermsType="BASIC_NET">
        <paymentTimePeriod>
          <value t-field="record.field_sales.payment_term_id" />
        </paymentTimePeriod>
      </netPayment>
    </paymentTerms>
    <t t-set="cont" t-value="0" />
    <t t-foreach="record.field_sales.order_line" t-as="rec" >
      <t t-set="cont" t-value="cont + 1" />
      <lineItem>
        <type>SimpleInvoiceLineItemType</type>
        <number t-esc="cont" />
        <tradeItemIdentification>
          <gtin t-esc="rec.product_id.barcode" />
        </tradeItemIdentification>
        <tradeItemDescriptionInformation>
          <language>ES</language>
          <longText t-esc="rec.product_id.name" />
        </tradeItemDescriptionInformation>
        <invoicedQuantity>
          <unitOfMeasure t-esc="rec.product_uom.name" />
          <quantity t-esc="rec.product_uom_qty" />
        </invoicedQuantity>
        <grossPrice>
          <amount t-esc="rec.price_unit" />
        </grossPrice>
        <netPrice>
          <t t-set="pricenet" t-value="rec.price_unit" />
          <t t-foreach="rec.tax_id" t-as="tc" >
            <t t-foreach="tc.tag_ids" t-as="tg" >
              <t t-if="tg.name != 'IEPS'" >
                <t t-set="result" t-value="rec.price_unit" />
                <t t-set="resultoper" t-value="result * (tc.amount / 100)" />
                <t t-set="pricenet" t-value="pricenet + resultoper" />
              </t>
            </t>
          </t>
          <amount t-esc="pricenet"  />
        </netPrice>
        <AdditionalInformation>
          <referenceIdentification type="ON" t-field="record.field_sales.number_order"  />
        </AdditionalInformation>
          <t t-set="amount" t-value="0" />
          <t t-foreach="rec.tax_id" t-as="tac" >
            <t t-foreach="tac.tag_ids" t-as="tag" >
              <t t-if="record.partner_id.most_ieps == False">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
              <t t-else="">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
                <t t-else="">
                  <tradeItemTaxInformation>
                    <taxTypeDescription>IEPS</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxAmount t-esc="tac.amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
            </t>
          </t>
          <totalLineAmount>
            <netAmount>
              <amount t-esc="rec.price_unit * rec.product_uom_qty" />
            </netAmount>
          </totalLineAmount>
      </lineItem>
    </t>
    <totalAmount>
      <t t-set="valamount" t-value="0" />
      <t t-foreach="record.field_sales.order_line" t-as="rec" >
        <t t-set="valamount" t-value="valamount + rec.price_subtotal" />
      </t>
      <Amount t-esc="valamount" />
    </totalAmount>
    <TotalAllowanceCharge allowanceOrChargeType="ALLOWANCE">
      <specialServicesType>AJ</specialServicesType>
      <Amount>0.00</Amount>
    </TotalAllowanceCharge>
    <baseAmount>
      <Amount t-esc="valamount" />
    </baseAmount>
    <payableAmount>
      <Amount t-field="record.field_sales.amount_total" />
    </payableAmount>
  </requestForPayment>
</template>

<!-- PROVEEDORA DEL PANADERO -->

<?xml version="1.0"?>
<template name="Proveedora del panadero" t-name="add.proveedora">
  <requestForPayment type="SimpleInvoiceType" contentVersion="1.3.1" documentStructureVersion="AMC7.1" documentStatus="ORIGINAL">
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />
    <requestForPaymentIdentification>
      <entityType>INVOICE</entityType>
      <t t-set="folio" t-value="xml.get('Folio')" />
      <uniqueCreatorIdentification t-esc="folio" />
    </requestForPaymentIdentification>
    <specialInstruction code="zzz">
      <text t-field="record.amount_to_text" />
    </specialInstruction>
    <seller>
      <alternatePartyIdentification type="SELLER_ASSIGNED_IDENTIFIER_FOR_A_PARTY">
      </alternatePartyIdentification>
    </seller>
    <shipTo>
      <gln t-field="record.partner_id.number_sucursal"/>
      <nameAndAddress>
        <name t-field="record.partner_id.name" />
        <streetAddressOne t-field="record.partner_id.street" />
        <city t-field="record.partner_id.city"/>
        <postalCode t-field="record.partner_id.zip"/>
      </nameAndAddress>
    </shipTo>
    <currency>
      <currencyISOCode t-field="record.currency_id.name" />
    </currency>
    <t t-set="cont" t-value="0" />
    <t t-foreach="record.field_sales.order_line" t-as="rec" >
      <t t-set="cont" t-value="cont + 1" />
      <lineItem type="SimpleInvoiceLineItemType">
        <number t-esc="cont" />
        <tradeItemIdentification>
          <gtin t-esc="rec.product_id.barcode" />
        </tradeItemIdentification>
        <tradeItemDescriptionInformation>
          <language>ES</language>
          <longText t-esc="rec.product_id.name" />
        </tradeItemDescriptionInformation>
        <invoicedQuantity>
          <unitOfMeasure t-esc="rec.product_uom.name" />
          <quantity t-esc="rec.product_uom_qty" />
        </invoicedQuantity>
        <grossPrice>
          <amount t-esc="rec.price_unit" />
        </grossPrice>
        <netPrice>
          <t t-set="pricenet" t-value="rec.price_unit" />
          <t t-foreach="rec.tax_id" t-as="tc" >
            <t t-foreach="tc.tag_ids" t-as="tg" >
              <t t-if="tg.name != 'IEPS'" >
                <t t-set="result" t-value="rec.price_unit" />
                <t t-set="resultoper" t-value="result * (tc.amount / 100)" />
                <t t-set="pricenet" t-value="pricenet + resultoper" />
              </t>
            </t>
          </t>
          <amount t-esc="pricenet"  />
        </netPrice>
          <t t-set="amount" t-value="0" />
          <t t-foreach="rec.tax_id" t-as="tac" >
            <t t-foreach="tac.tag_ids" t-as="tag" >
              <t t-if="record.partner_id.most_ieps == False">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
              <t t-else="">
                <t t-if="tag.name != 'IEPS'">
                  <t t-set="result" t-value="rec.price_unit" />
                  <t t-set="resultoper" t-value="result * (tac.amount / 100)" />
                  <t t-set="amount" t-value="amount + resultoper" />
                  <tradeItemTaxInformation>
                    <taxTypeDescription>VAT</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxPercentaje t-esc="tac.amount" />
                      <taxAmount t-esc="amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
                <t t-else="">
                  <tradeItemTaxInformation>
                    <taxTypeDescription>IEPS</taxTypeDescription>
                    <tradeItemTaxAmount>
                      <taxAmount t-esc="tac.amount" />
                    </tradeItemTaxAmount>
                  </tradeItemTaxInformation>
                </t>
              </t>
            </t>
          </t>
          <totalLineAmount>
            <netAmount>
              <amount t-esc="rec.price_unit * rec.product_uom_qty" />
            </netAmount>
          </totalLineAmount>
      </lineItem>
    </t>
    <totalAmount>
      <t t-set="valamount" t-value="0" />
      <t t-foreach="record.field_sales.order_line" t-as="rec" >
        <t t-set="valamount" t-value="valamount + rec.price_subtotal"/>
      </t>
      <Amount t-esc="valamount" />
    </totalAmount>
    <baseAmount>
      <Amount t-esc="valamount" />
    </baseAmount>
    <fechaEntregaRequerida t-field="record.field_sales.date_of_deli" />
    <numeroOrden t-field="record.field_sales.number_order" />
    <numeroTienda t-field="record.partner_id.number_store" />
  </requestForPayment>
</template>

<!-- CHEDRAUI -->

<?xml version="1.0"?>
<template name="Chedraui" t-name="add.chedraui">
  <EDCINVOICE>
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />
    <!-- Datos del XML generado al timbrar -->
    <t t-set="serie" t-value="xml.get('Serie')" />
    <t t-set="folio" t-value="xml.get('Folio')" />
    <t t-set="fecha" t-value="xml.get('Fecha')" />
    <t t-set="nameem" t-value="xml.Emisor.get('Nombre')" />
    <t t-set="rfcem" t-value="xml.Emisor.get('Rfc')" />
    <t t-set="lugex" t-value="xml.Emisor.get('LugarExpedicion')" />
    <t t-set="metpa" t-value="xml.get('MetodoPago')" />
    <testeo t-esc="h1c" />
    <tmp t-esc="'[H1]'+'|'+serie+'|'+folio+'|'+fecha" />
    <serie t-esc="serie" />
    <folio t-esc="folio" />
    <fecha t-esc="fecha" />
    <!-- Datos de la empresa -->
    <t t-set="street" t-value="record.company_id.street_name" />
    <t t-set="reference" t-value="record.company_id.street2" />
    <t t-set="numext" t-value="record.company_id.street_number" />
    <t t-set="numint" t-value="record.company_id.street_number2" />
    <t t-set="colony" t-value="record.company_id.l10n_mx_edi_colony" />
    <t t-set="locality" t-value="record.company_id.l10n_mx_edi_locality" />
    <t t-set="city" t-value="record.company_id.city" />
    <t t-set="state" t-value="record.company_id.state_id.name" />
    <t t-set="country" t-value="record.company_id.country_id.name" />
    <t t-set="codpost" t-value="record.company_id.zip" />
    <tagH3 t-esc="'[H3]'+'|'+nameem+'|'+street+'|'+numext+'|'+numint+'|'+colony+'|'+locality+'|'+city+'|'+state+'|'+country+'|'+codpost+'|' " />
    <!-- Datos del cliente -->
    <t t-set="namecli" t-value="record.partner_id.name" />
    <t t-set="streetcli" t-value="record.partner_id.street_name" />
    <t t-set="referencecli" t-value="record.partner_id.street2" />
    <t t-set="numextcli" t-value="record.partner_id.street_number" />
    <t t-set="numintcli" t-value="record.partner_id.street_number2" />
    <t t-set="colonycli" t-value="record.partner_id.l10n_mx_edi_colony" />
    <t t-set="localitycli" t-value="record.partner_id.l10n_mx_edi_locality" />
    <t t-set="citycli" t-value="record.partner_id.city" />
    <t t-set="statecli" t-value="record.partner_id.state_id.name" />
    <t t-set="countrycli" t-value="record.partner_id.country_id.name" />
    <t t-set="codpostcli" t-value="record.partner_id.zip" />
    <tagH4 t-esc="'[H4]'+'|'+namecli+'|'+streetcli+'|'+numextcli+'|'+numintcli+'|'+colonycli+'|'+localitycli+'|'+citycli+'|'+statecli+'|'+countrycli+'|'+codpostcli+'|' " />
    <!-- Datos del lugar a entregar -->
    <t t-set="phoneent" t-value="record.partner_shipping_id.phone" />
    <t t-set="emailent" t-value="record.partner_shipping_id.email" />
    <t t-set="nameent" t-value="record.partner_shipping_id.name" />
    <t t-set="streetent" t-value="record.partner_shipping_id.street_name" />
    <t t-set="numextent" t-value="record.partner_shipping_id.street_number" />
    <t t-set="numintent" t-value="record.partner_shipping_id.street_number2" />
    <t t-set="colonyent" t-value="record.partner_shipping_id.l10n_mx_edi_colony" />
    <t t-set="localityent" t-value="record.partner_shipping_id.l10n_mx_edi_locality" />
    <t t-set="cityent" t-value="record.partner_shipping_id.city" />
    <t t-set="stateent" t-value="record.partner_shipping_id.state_id.name" />
    <t t-set="countryent" t-value="record.partner_shipping_id.country_id.name" />
    <t t-set="codpostent" t-value="record.partner_shipping_id.zip" />
    <tagH5 t-esc="'[H5]'+'|'+nameent+'|'+streetent+'|'+numextent+'|'+numintent+'|'+colonyent+'|'+localityent+'|'+cityent+'|'+stateent+'|'+countryent+'|'+codpostent+'|' " />

  </EDCINVOICE>
</template>



<?xml version="1.0"?>
<template name="Chedraui" t-name="add.chedraui">
    <t t-set="xml" t-value="record.l10n_mx_edi_get_xml_etree()" />

    <t t-set="versi" t-value="xml.get('Version')" />
    <t t-set="serie" t-value="xml.get('Serie')" />
    <t t-set="folio" t-value="xml.get('Folio')" />
    <t t-set="fecha" t-value="xml.get('Fecha')" />
    <t t-set="nocer" t-value="xml.get('NoCertificado')" />
    <t t-set="metpa" t-value="xml.get('MetodoPago')" />
    <t t-set="formp" t-value="xml.get('FormaPago')" />
    <t t-set="condp" t-value="xml.get('CondicionesDePago')" />
    <t t-set="subto" t-value="xml.get('SubTotal')" />
    <t t-set="moned" t-value="xml.get('Moneda')" />
    <!-- <t t-set="tipca" t-value="xml.get('TipoCambio')" /> -->
    <t t-set="total" t-value="xml.get('Total')" />
    <t t-set="tipoc" t-value="xml.get('TipoDeComprobante')" />
    <t t-set="lugex" t-value="xml.get('LugarExpedicion')" />

    <!-- Datos emisor -->
    <t t-set="nameem" t-value="xml.Emisor.get('Nombre')" />
    <t t-set="rfcem" t-value="xml.Emisor.get('Rfc')" />
    <t t-set="regfi" t-value="xml.Emisor.get('RegimenFiscal')" />

    <!-- Datos receptor -->
    <t t-set="rfcrec" t-value="xml.Receptor.get('Rfc')" />
    <t t-set="namrec" t-value="xml.Receptor.get('Nombre')" />
    <t t-set="usocfd" t-value="xml.Receptor.get('UsoCFDI')" />

    <!-- Datos del H2 -->
    <t t-set="taghcero" t-value="'[H0]'+'|'+rfcrec+'|'+nocer+'|'+' '" />

    <!-- Datos del H1 -->
    <t t-set="taghpri" t-value="'[H1]'+'|'+serie+'|'+folio+'|'+fecha+'|'+' '" />

    <!-- Datos de la empresa -->
    <t t-set="street" t-value="record.company_id.street_name" />
    <!-- <t t-set="reference" t-value="record.company_id.street2" /> -->
    <t t-set="numext" t-value="record.company_id.street_number" />
    <t t-set="numint" t-value="record.company_id.street_number2" />
    <t t-set="colony" t-value="record.company_id.l10n_mx_edi_colony" />
    <t t-set="locality" t-value="record.company_id.l10n_mx_edi_locality" />
    <t t-set="city" t-value="record.company_id.city" />
    <t t-set="state" t-value="record.company_id.state_id.name" />
    <t t-set="country" t-value="record.company_id.country_id.name" />
    <t t-set="codpost" t-value="record.company_id.zip" />
    <t t-set="taghdos" t-value="'[H3]'+'|'+nameem+'|'+street+'|'+numext+'|'+numint+'|'+colony+'|'+locality+'|'+city+'|'+state+
    '|'+country+'|'+codpost+'|'+' '" />

    <!-- Datos del cliente -->
    <t t-set="namecli" t-value="record.partner_id.name" />
    <t t-set="streetcli" t-value="record.partner_id.street_name" />
    <t t-set="referencecli" t-value="record.partner_id.street2" />
    <t t-set="numextcli" t-value="record.partner_id.street_number" />
    <t t-set="numintcli" t-value="record.partner_id.street_number2" />
    <t t-set="colonycli" t-value="record.partner_id.l10n_mx_edi_colony" />
    <t t-set="localitycli" t-value="record.partner_id.l10n_mx_edi_locality" />
    <t t-set="citycli" t-value="record.partner_id.city" />
    <t t-set="statecli" t-value="record.partner_id.state_id.name" />
    <t t-set="countrycli" t-value="record.partner_id.country_id.name" />
    <t t-set="codpostcli" t-value="record.partner_id.zip" />
    <t t-set="taghtres" t-value="'[H4]'+'|'+namecli+'|'+streetcli+'|'+numextcli+'|'+numintcli+'|'+colonycli+'|'+localitycli+'|'+citycli+'|'+statecli+'|'
    +countrycli+'|'+codpostcli+'|'+' '" />

    <!-- Datos del lugar a entregar -->
    <t t-set="phoneent" t-value="record.partner_shipping_id.phone" />
    <t t-set="emailent" t-value="record.partner_shipping_id.email" />
    <t t-set="nameent" t-value="record.partner_shipping_id.name" />
    <t t-set="streetent" t-value="record.partner_shipping_id.street_name" />
    <t t-set="numextent" t-value="record.partner_shipping_id.street_number" />
    <t t-set="numintent" t-value="record.partner_shipping_id.street_number2" />
    <t t-set="colonyent" t-value="record.partner_shipping_id.l10n_mx_edi_colony" />
    <t t-set="localityent" t-value="record.partner_shipping_id.l10n_mx_edi_locality" />
    <t t-set="cityent" t-value="record.partner_shipping_id.city" />
    <t t-set="stateent" t-value="record.partner_shipping_id.state_id.name" />
    <t t-set="countryent" t-value="record.partner_shipping_id.country_id.name" />
    <t t-set="codpostent" t-value="record.partner_shipping_id.zip" />
    <t t-set="taghcinco" t-value="'[H5]'+'|'+nameent+'|'+streetent+'|'+numextent+'|'+numintent+'|'+colonyent+'|'
    +localityent+'|'+cityent+'|'+stateent+'|'+countryent+'|'+codpostent+'|'+' '" />
    
    <t t-set="tagprod" t-value="''.join(map(lambda x: ('[D]'+x.product_id.l10n_mx_edi_code_sat_id.code+'|'+x.product_id.barcode+'|'+x.product_id.name+'|'+str(x.product_uom_qty)+'|'+x.product_uom.name+'|'+str(x.price_unit)+'|'), record.fields_sales.order_line))"/>

    <t t-set="tagpen" t-value="'[CO]'+'|'+versi+'|'+serie+'|'+folio+'|'+fecha+'|'+formp+'|'+nocer+'|'+condp+'|'+subto+'|'
    +moned+'|'+total+'|'+tipoc+'|'+metpa+'|'+lugex+'|'+rfcem+'|'+nameem+'|'+regfi+'|'+rfcrec+'|'+namrec+'|'+usocfd+'|' " />
    
    <t t-set="valorconcept" t-value="''.join(map(lambda x: (x.get('ClaveProdServ')+'|'+x.get('NoIdentificacion')+'|'+x.get('Cantidad')+'|'+x.get('ClaveUnidad')+'|'+x.get('Unidad')+'|'+x.get('Descripcion')+'|'+x.get('ValorUnitario')+'|'+x.get('Importe')+'|'+''.join(map(lambda i:(i.get('Base')+'|'+i.get('Impuesto')+'|'+i.get('TipoFactor')+'|'+i.get('TasaOCuota')+'|'+i.get('Importe')+'|'), x.Impuestos.Traslados.Traslado))), xml.Conceptos.Concepto))"/>

    <t t-set="tagfinal" t-value="taghcero+taghpri+taghdos+taghtres+taghcinco+tagprod+tagpen+valorconcept"/>

    <EDCINOVICE t-esc="tagfinal" />

    
    
</template>










